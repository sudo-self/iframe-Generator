// Enhanced JavaScript with better functionality
$(document).ready(function() {
  // Initialize the generator
  generateIframe();
  
  // Set up event listeners
  $('input').on('change keyup', function(e) {
    if (e.type === 'keyup' && $(this).attr('id') === 'url' && e.key !== 'Enter') {
      return; // Only regenerate on Enter key for URL input
    }
    
    if (e.type === 'keyup' && $(this).attr('id') === 'url' && e.key === 'Enter') {
      generateIframe();
      return;
    }
    
    if (e.type === 'change') {
      generateIframe();
    }
  });
  
  // Initialize clipboard
  new ClipboardJS('.btn');
  
  // Add success feedback for copy buttons
  $('.btn').on('click', function() {
    const originalText = $(this).html();
    $(this).html('<span class="btn-icon">âœ…</span> Copied!');
    
    setTimeout(() => {
      $(this).html(originalText);
    }, 2000);
  });
});

function generateIframe() {
  // Get values from inputs
  const isYtbAttrChecked = $('#ytbAttr').is(':checked');
  const url = $('#url').val();
  const selectedSize = $('[type="radio"]:checked').val();
  
  // Prepare iframe attributes
  let args = '';
  if (isYtbAttrChecked) {
    args = 'allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen';
  }
  
  // Calculate aspect ratio
  const dimensions = selectedSize.split('x');
  const aspectRatio = (100 * dimensions[1]) / dimensions[0];
  $('#proportions').text(aspectRatio.toFixed(2));
  
  // Create iframe HTML
  const iframe = $('<iframe border="0" loading="lazy" ' + args + ' />');
  const container = $('<div class="iframe-container" />');
  
  iframe.attr('src', url);
  container.html(iframe);
  
  // Update HTML code display
  $('#html').text(container.prop('outerHTML'));
  
  // Update preview
  $('#preview').html(container.clone());
  
  // Update CSS in style tag
  const cleanStyle = $('#css').prop('innerHTML').replace(/(<([^>]+)>)/ig,"");
  $('#style').text(cleanStyle);
  
  // Add visual feedback for generation
  $('.preview-section').addClass('pulse');
  setTimeout(() => {
    $('.preview-section').removeClass('pulse');
  }, 500);
}

// Add CSS for pulse animation
$('head').append(`
  <style>
    .pulse {
      animation: pulse 0.5s ease;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(52, 152, 219, 0); }
      100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); }
    }
  </style>
`);
